## report_bonus

#### author: KevinLee0328

### 1) 构思准备

1) 通过阅读**DSProject.pdf**，了解pj要求，确定先完成**base**任务的parser部分，再尝试完成**bonus**任务的json输出部分。
2) 观察所给示例文件**sample.bvh**和**output.json**，发现两种格式均是嵌套结构，初步确定以工作栈或迭代方法完成。
3) 通过WSL搭建运行环境，在安装Ubuntu过程中，由于win11系统的虚拟机功能不齐全，参考了各种网络资料进行解决，不过由于这个过程与pj实际关联不大，此处不多做赘述。

### 2) 工作过程

#### base任务：

1) 编写代码框架，用**bvh_joint**函数读取**Hierarchy**结构，用**bvh_META**函数读取**Motion**部分的frame信息，用**bvh_data**函数循环读取**Motion**部分的每组运动数据。
2) 用**token**变量从输入流中读取信息，并根据if判断赋值或舍弃。
3) 一开始使用了标准库的stack工作栈存放**joint***，之后发现在不要求时空性能优化的情况下，迭代方法会使代码简洁易读，遂改变策略。（事实上，迭代是通过递归工作栈实现的，因此这二者是殊途同归的。）
4) 以读取到**}**作为迭代结束的条件，依照顺序读取各类数据，直接使用了所给示例文件的代码框架和结构体。
5) 修正对**End**节点的特殊处理，修正对冗余提示信息的舍弃处理。
6) 使用**sample.bvh**和**json.o**，编译运行**base**，与所给示例文件**output.json**对照，得到正确结果。

#### bonus任务：

1) 用**output_joint**函数输出同一层级的各类数据，用迭代方法输出嵌套结构。
2) 注意到相邻层级的输出缩进相差2个tab，用**tab**变量记录每层至少需要的缩进数量，迭代时以**tab+2**传递至下一层级。
3) 修正对**\t**、**(空格)** 、**\\** 、**,**、**:**、**[]**、**{}**等提示信息的输出处理。
4) 注意到使用示例文件**Makefile**编译运行**bonus**抛出错误，结合错误提示信息将**Makefile**的其中一行删去（用**#**注释），得到了可以编译通过的文件；其后**2022.12.6 update**对**Makefile**进行了更新，于是直接使用了更新后的版本。
5) 注意到在修正过程中，**sample.bvh**中的数据过于冗长，导致难以检查输出正确性，于是通过**DSProject.pdf**中的[链接](https://zhuanlan.zhihu.com/p/539522515)获得更为简洁的bvh文件示例，有助于快速发现错误。
6) 使用**sample.bvh**，编译运行**bonus**，与所给示例文件**output.json**对照，得到正确结果。

### 3) 收获总结

1) 编写代码前选择合适的数据结构有助于保证代码正确性，并提升代码可读性。
2) 进行复杂结构的数据读入、输出时，在代码初次编写时最好能保证代码逻辑的正确性，否则将对代码后续修正带来重复的工作量。
3) 本次pj帮助巩固和加深了对课堂学习的数据结构内容的理解。
4) 本次pj的编译运行环境要求激发了对Ubuntu等Linux子系统应用的兴趣。

### 4) 参考帮助

1) elearning上发布的所给示例文件，以及pj要求中包含的链接。
2) 关于算法思想与实现方法，与同学的少量口头讨论。